#
# Shell script to automate datalogging
#

database="ctd.sqlite"
gsm="/dev/tty.T610-SerialPort1"
gps="/dev/tty.BTGPS-BluetoothSerialPo"
obd="/dev/tty.CHX-DevB"

echo "CaptureTheData! Automated Shell Script"
echo -e "\tDatabase:\t$database"
echo -e "\tGSM device:\t$gsm"
echo -e "\tGPS device:\t$gps"
echo -e "\tOBD device:\t$obd\n"


./ctd create $database
tripid=$?
echo "Database created with ID $tripid"

if [ $tripid != 0 ] ; then
	echo "Log GSM"
	./ctd log gsm $gsm $database $tripid &

	echo "Log GPS"
	./ctd log gps $gps $database $tripid &
	
	echo "Log OBD"
	./ctd log obd $obd $database $tripid &

	read -p "Press any key to stop logging and start post-processing...\n"
	
	killall ctd
	
	echo "Parse data"
	./ctd parse $database $tripid
	
	echo "Generate reports"
	./ctd report $database $tripid
	
	echo "Script finished"
fi