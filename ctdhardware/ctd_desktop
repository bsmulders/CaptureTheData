#
# Shell script to automate datalogging
#

database="../ctdstorage/testset.sqlite"
executable="./../ctdlogger/build/ctd"
gsm="/dev/tty.T610-SerialPort1"
gps="/dev/tty.BTGPS-BluetoothSerialPo"
obd="/dev/tty.CHX-DevB"
wii="0021BD2E8C06"

echo "CaptureTheData! Automated Shell Script"
echo -e "\tDatabase:\t$database"
echo -e "\tGSM device:\t$gsm"
echo -e "\tGPS device:\t$gps"
echo -e "\tOBD device:\t$obd\n"
echo -e "\tWii device:\t$wii\n"


$executable create $database
tripid=$?
echo "Trip created with ID $tripid"

if [ $tripid != 0 ] ; then
	echo "Log GSM"
	$executable log gsm $gsm $database $tripid &

	echo "Log GPS"
	$executable log gps $gps $database $tripid &
	
	echo "Log OBD"
	$executable log obd $obd $database $tripid &

	echo "Log Wii"
	$executable log wii $wii $database $tripid &

	echo "Press any key to stop logging and start post-processing...\n"
	read
	
	killall -SIGINT ctd
	
	echo "Parse data"
	$executable parse $database $tripid
	
	echo "Generate reports"
	$executable report $database $tripid
	
	echo "Script finished"
fi